# SuiteCommerce Advanced (SCA) Development Rules

## CRITICAL: Research Before Implementation

Before extending, wrapping, hooking, or modifying ANY existing SCA functionality:

1. **Read the core source file** - Find and read the actual implementation in `core/sca-dev-*/` BEFORE writing any code
2. **Trace the complete data flow** - Frontend form → Service → Backend Model → NetSuite record
3. **Identify all related files** - Models, Views, Services, Templates that interact with target functionality
4. **Verify NetSuite field IDs** - Check actual internal IDs in NetSuite Records Browser, never assume

## SuiteScript Version Rules

| Context | Version | API Style |
|---------|---------|-----------|
| SSP Libraries (ssp-libraries in manifest.json) | SuiteScript 1.0 | `nlapiSearchRecord`, `nlobjSearchFilter`, `nlapiLogExecution` |
| Suitelets, UserEvents, Scheduled Scripts, Map/Reduce | SuiteScript 2.x | `N/record`, `N/search`, `N/log`, arrow functions |

**Never mix versions** - SSP libraries MUST use 1.0 syntax.

## SCA Backend Event System

Events are generated by SC.EventWrapper as `before:ModelName.methodName` and `after:ModelName.methodName`.

To find correct event names:
1. Find the Model file (e.g., `Account.Model.js`)
2. Model name = value of `name` property (e.g., `'Account'`)
3. Method name = the function (e.g., `register`)
4. Events = `before:Account.register`, `after:Account.register`

**Never guess event names** - Always verify in source.

## SCA Registration Flow

```
Account.Model.register():
1. registerCustomer() → Creates Lead/Customer (custom fields EMPTY)
2. updateProfile() → Adds custentity_* fields (SEPARATE operation)
```

UserEvent implications:
- CREATE event: `custentity_*` fields are EMPTY
- EDIT event: `custentity_*` fields are POPULATED
- Handle BOTH events when working with custom entity fields

## SCA Frontend Patterns

### Validation Errors
```html
<!-- CORRECT -->
<p data-validation-error="block" id="error-id" style="display: none;"></p>

<!-- WRONG -->
<div class="backbone-validation"></div>
```

### CSS Rules
- `overflow: hidden` BLOCKS jQuery `slideDown()`/`slideUp()` animations
- Use inline `style="display: none;"` for initially hidden elements

### Form Fields
- Field `name` attribute MUST match NetSuite field internal ID exactly
- `custentity_*` fields are auto-extracted and sent to backend by SCA

## NetSuite API Patterns

### Accounting Lists (SuiteScript 1.0)
```javascript
// CORRECT - Search the accounting list
nlapiSearchRecord('customercategory', null, filters, columns);

// WRONG - Doesn't work for accounting lists
record.getField('category').getSelectOptions();
```

### Permissions
- SSP Libraries have LIMITED permissions
- Use Suitelets (Execute As: Administrator) for elevated operations
- Suitelets can update records that SSP libraries cannot

## Debugging

1. Use `log.audit()` for entry points (always visible)
2. Use `log.debug()` for detailed tracing
3. Check Execution Log in NetSuite deployment record
4. Test CREATE and EDIT events separately for UserEvents

## Common Pitfalls

1. **Assuming field values** - Always verify internal IDs in NetSuite
2. **Mixing SuiteScript versions** - SSP must use 1.0, scripts use 2.x
3. **Wrong event names** - Always check Model name property
4. **Missing permissions** - Use Suitelets for elevated operations
5. **Custom fields on CREATE** - They're empty during customer creation